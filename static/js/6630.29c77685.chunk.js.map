{"version":3,"file":"static/js/6630.29c77685.chunk.js","mappings":"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","sources":["D2App/pages/dataElementGroups/New.js","D2App/pages/dataElementGroups/fields/DataElementsField.js","D2App/pages/dataElementGroups/form/DataElementGroupFormFields.js","D2App/pages/dataElementGroups/form/dataElementGroupSchema.js","webpack://@dhis2/app-shell/./src/D2App/pages/dataElementGroups/New.module.css?3b69","webpack://@dhis2/app-shell/./src/D2App/pages/dataElementGroups/fields/DataElementsField.module.css?3e66"],"sourcesContent":["import { useDataEngine } from '@dhis2/app-runtime';\nimport i18n from '@dhis2/d2-i18n';\nimport { NoticeBox } from '@dhis2/ui';\nimport { FORM_ERROR } from 'final-form';\nimport React, { useEffect, useMemo, useRef } from 'react';\nimport { Form } from 'react-final-form';\nimport { useNavigate } from 'react-router-dom';\nimport { Loader, StandardFormActions, StandardFormSection } from '../../components';\nimport { useCustomAttributesQuery } from '../../components/form';\nimport { SCHEMA_SECTIONS, getSectionPath, validate } from '../../lib';\nimport { DataElementGroupFormFields, dataElementGroupSchema } from './form';\nimport classes from './New.module.css';\nconst listPath = `/${getSectionPath(SCHEMA_SECTIONS.dataElementGroup)}`;\nfunction useInitialValues(customAttributes) {\n  const attributeValues = useMemo(() => customAttributes.map(attribute => ({\n    attribute,\n    value: ''\n  })), [customAttributes]);\n  return {\n    name: '',\n    shortName: '',\n    code: '',\n    description: '',\n    dataElements: [],\n    attributeValues\n  };\n}\nconst ADD_NEW_DATA_ELEMENT_GROUP_MUTATION = {\n  resource: 'dataElementGroups',\n  type: 'create',\n  data: de => de\n};\nexport function Component() {\n  const dataEngine = useDataEngine();\n  const navigate = useNavigate();\n  const customAttributesQuery = useCustomAttributesQuery();\n  const initialValues = useInitialValues(customAttributesQuery.data);\n  async function onSubmit(payload) {\n    try {\n      // We want the promise so we know when submitting is done. The promise\n      // returned by the mutation function of useDataMutation will never\n      // resolve\n      await dataEngine.mutate(ADD_NEW_DATA_ELEMENT_GROUP_MUTATION, {\n        variables: payload\n      });\n    } catch (e) {\n      return {\n        [FORM_ERROR]: e.toString()\n      };\n    }\n    navigate(listPath);\n  }\n  return /*#__PURE__*/React.createElement(Loader, {\n    queryResponse: customAttributesQuery,\n    label: i18n.t('Custom attributes')\n  }, /*#__PURE__*/React.createElement(Form, {\n    validateOnBlur: true,\n    onSubmit: onSubmit,\n    validate: values => {\n      return validate(dataElementGroupSchema, values);\n    },\n    initialValues: initialValues\n  }, _ref => {\n    let {\n      handleSubmit,\n      submitting,\n      submitError\n    } = _ref;\n    return /*#__PURE__*/React.createElement(\"form\", {\n      onSubmit: handleSubmit\n    }, /*#__PURE__*/React.createElement(FormContents, {\n      submitError: submitError,\n      submitting: submitting,\n      onCancelClick: () => navigate(listPath)\n    }));\n  }));\n}\nfunction FormContents(_ref2) {\n  let {\n    submitError,\n    onCancelClick,\n    submitting\n  } = _ref2;\n  const formErrorRef = useRef(null);\n  useEffect(() => {\n    if (submitError) {\n      var _formErrorRef$current;\n      (_formErrorRef$current = formErrorRef.current) === null || _formErrorRef$current === void 0 ? void 0 : _formErrorRef$current.scrollIntoView({\n        behavior: 'smooth'\n      });\n    }\n  }, [submitError]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.form\n  }, /*#__PURE__*/React.createElement(DataElementGroupFormFields, null), submitError && /*#__PURE__*/React.createElement(StandardFormSection, null, /*#__PURE__*/React.createElement(\"div\", {\n    ref: formErrorRef\n  }, /*#__PURE__*/React.createElement(NoticeBox, {\n    error: true,\n    title: i18n.t('Something went wrong when submitting the form')\n  }, submitError))), /*#__PURE__*/React.createElement(StandardFormSection, null, /*#__PURE__*/React.createElement(StandardFormActions, {\n    cancelLabel: i18n.t('Exit without saving'),\n    submitLabel: i18n.t('Create data element group'),\n    submitting: submitting,\n    onCancelClick: onCancelClick\n  }))));\n}","import i18n from '@dhis2/d2-i18n';\nimport { ButtonStrip, Button, Field } from '@dhis2/ui';\nimport React, { useRef } from 'react';\nimport { useField } from 'react-final-form';\nimport { useHref } from 'react-router';\nimport { DataElementsTransfer } from '../../../components';\nimport classes from './DataElementsField.module.css';\n\n/**\n *\n * DataElements\n *\n */\nexport function DataElementsField() {\n  var _meta$error;\n  const name = 'dataElements';\n  const {\n    input,\n    meta\n  } = useField(name, {\n    multiple: true,\n    format: dataElements => dataElements === null || dataElements === void 0 ? void 0 : dataElements.map(dataElements => dataElements.id),\n    parse: ids => ids.map(id => ({\n      id\n    })),\n    validateFields: []\n  });\n  const newDataElementsLink = useHref('/dataElements/new');\n  const dataElementsHandle = useRef({\n    refetch: () => console.error('Not initialized')\n  });\n  const rightHeader = /*#__PURE__*/React.createElement(\"p\", {\n    className: classes.dataElementsPickedHeader\n  }, i18n.t('Selected data elements'));\n  const leftFooter = /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.dataElementsOptionsFooter\n  }, /*#__PURE__*/React.createElement(ButtonStrip, null, /*#__PURE__*/React.createElement(Button, {\n    small: true,\n    onClick: dataElementsHandle.current.refetch\n  }, i18n.t('Refresh list')), /*#__PURE__*/React.createElement(Button, {\n    small: true,\n    onClick: () => window.open(newDataElementsLink, '_blank')\n  }, i18n.t('Add new'))));\n  return /*#__PURE__*/React.createElement(Field, {\n    dataTest: \"formfields-dataElementsets\",\n    error: !!meta.error,\n    validationText: (_meta$error = meta.error) === null || _meta$error === void 0 ? void 0 : _meta$error.toString(),\n    name: name\n  }, /*#__PURE__*/React.createElement(DataElementsTransfer, {\n    ref: dataElementsHandle,\n    selected: input.value,\n    onChange: _ref => {\n      let {\n        selected\n      } = _ref;\n      return input.onChange(selected);\n    },\n    rightHeader: rightHeader,\n    leftFooter: leftFooter\n  }));\n}","import i18n from '@dhis2/d2-i18n';\nimport React from 'react';\nimport { StandardFormSection, StandardFormSectionTitle, StandardFormSectionDescription, StandardFormField, CustomAttributesSection } from '../../../components';\nimport { DefaultIdentifiableFields, DescriptionField } from '../../../components/form';\nimport { SCHEMA_SECTIONS } from '../../../lib';\nimport { DataElementsField } from '../fields';\nconst section = SCHEMA_SECTIONS.dataElementGroup;\nexport function DataElementGroupFormFields() {\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(StandardFormSection, null, /*#__PURE__*/React.createElement(StandardFormSectionTitle, null, i18n.t('Basic information')), /*#__PURE__*/React.createElement(StandardFormSectionDescription, null, i18n.t('Set up the information for this data element group')), /*#__PURE__*/React.createElement(DefaultIdentifiableFields, null), /*#__PURE__*/React.createElement(StandardFormField, null, /*#__PURE__*/React.createElement(DescriptionField, {\n    schemaSection: section,\n    helpText: i18n.t('Explain the purpose of this data element group.')\n  }))), /*#__PURE__*/React.createElement(StandardFormSection, null, /*#__PURE__*/React.createElement(StandardFormSectionTitle, null, i18n.t('Data elements')), /*#__PURE__*/React.createElement(StandardFormSectionDescription, null, ''), /*#__PURE__*/React.createElement(StandardFormField, null, /*#__PURE__*/React.createElement(DataElementsField, null))), /*#__PURE__*/React.createElement(CustomAttributesSection, {\n    schemaSection: section\n  }));\n}","import { z } from 'zod';\nexport const dataElementGroupSchema = z.object({\n  name: z.string().trim(),\n  shortName: z.string().trim(),\n  code: z.string().trim(),\n  description: z.string().trim(),\n  dataElements: z.array(z.object({\n    id: z.string()\n  }))\n}).partial();","// extracted by mini-css-extract-plugin\nexport default {\"form\":\"New_form__FZ0wM\"};","// extracted by mini-css-extract-plugin\nexport default {\"dataElementsOptionsFooter\":\"DataElementsField_dataElementsOptionsFooter__Fn5g8\",\"dataElementsPickedHeader\":\"DataElementsField_dataElementsPickedHeader__bqjmJ\"};"],"names":["listPath","getSectionPath","SCHEMA_SECTIONS","dataElementGroup","ADD_NEW_DATA_ELEMENT_GROUP_MUTATION","resource","type","data","de","Component","dataEngine","useDataEngine","navigate","useNavigate","customAttributesQuery","useCustomAttributesQuery","initialValues","customAttributes","name","shortName","code","description","dataElements","attributeValues","useMemo","map","attribute","value","React","Loader","queryResponse","label","i18n","t","Form","validateOnBlur","onSubmit","async","payload","mutate","variables","e","FORM_ERROR","toString","validate","values","dataElementGroupSchema","_ref","handleSubmit","submitting","submitError","FormContents","onCancelClick","_ref2","formErrorRef","useRef","useEffect","_formErrorRef$current","current","scrollIntoView","behavior","className","classes","form","DataElementGroupFormFields","StandardFormSection","ref","NoticeBox","error","title","StandardFormActions","cancelLabel","submitLabel","DataElementsField","_meta$error","input","meta","useField","multiple","format","id","parse","ids","validateFields","newDataElementsLink","useHref","dataElementsHandle","refetch","console","rightHeader","dataElementsPickedHeader","leftFooter","dataElementsOptionsFooter","ButtonStrip","Button","small","onClick","window","open","Field","dataTest","validationText","DataElementsTransfer","selected","onChange","section","StandardFormSectionTitle","StandardFormSectionDescription","DefaultIdentifiableFields","StandardFormField","DescriptionField","schemaSection","helpText","CustomAttributesSection","z","object","string","trim","array","partial"],"sourceRoot":""}