(self.webpackChunk_dhis2_app_shell=self.webpackChunk_dhis2_app_shell||[]).push([[5824,9025,3240],{99025:function(e,t,a){"use strict";a.r(t),a.d(t,{CategoryComboField:function(){return u}});var o=a(28014),i=a(24394),n=a(72176),r=a(50445),l=a(14571),s=a(87899),d=a(16680),c=a(13240);const m=e=>{if(!e.id)return o.A.t("Required")};function u(){var e;const t=(0,d.Bp)(),{change:a}=(0,r.mN)(),{values:u}=(0,r.lN)({subscription:{values:!0}}),p="TRACKER"===u.domainType,y=p,g=y?void 0:m,h=(0,l.$P)("/categoryCombos/new"),{input:b,meta:C}=(0,r.Mt)("categoryCombo",{validateFields:[],validate:g,format:e=>e.id,parse:e=>({id:e})}),f=(0,n.useRef)({refetch:()=>{throw new Error("Not initialized")}});return(0,n.useEffect)((()=>{var e;null!==(e=t.data)&&void 0!==e&&e.id&&p&&a("categoryCombo.id",t.data.id)}),[a,null===(e=t.data)||void 0===e?void 0:e.id,p]),n.createElement(s.uV,{dataTest:"formfields-categorycombo",onRefresh:()=>f.current.refetch(),onAddNew:()=>window.open(h,"_blank")},n.createElement("div",{className:c.default.categoryComboSelect},n.createElement(i.D,{required:!0,name:"categoryCombo.id",label:o.A.t("{{fieldLabel}} (required)",{fieldLabel:o.A.t("Category combination")}),helpText:o.A.t("Choose how this data element is disaggregated"),error:C.touched&&!!C.error,validationText:C.touched?C.error:void 0,dataTest:"formfields-categorycombo"},n.createElement(s.R_,{required:!0,placeholder:"",disabled:y,invalid:C.touched&&!!C.error,ref:f,selected:b.value,onChange:e=>{let{selected:t}=e;b.onChange(t),b.onBlur()},onBlur:b.onBlur,onFocus:b.onFocus}))))}},17958:function(e,t,a){"use strict";var o=a(51594),i=a(72176),n=a(50445),r=a(14571),l=a(75204),s=a(65328),d=a(44369);const c=[{displayName:"Births",id:"m2jTvAj5kkm"},{displayName:"Commodities",id:"gbvX3pogf7p"},{displayName:"Fixed/Outreach",id:"KYYSTxeVw28"},{displayName:"Gender",id:"dPmavA0qloX"},{displayName:"HIV age",id:"Wfan7UwK8CQ"},{displayName:"HIV age+gender",id:"jCNGsC2NawV"},{displayName:"HIV Paed age+gender",id:"v1K6CE6bmtw"},{displayName:"Implementing Partner",id:"nM3u9s5a52V"},{displayName:"Implementing Partner and Projects",id:"O4VaNks6tta"},{displayName:"Location and age group",id:"dzjKKQq0cSO"},{displayName:"Maternal deaths",id:"sgoeVsAbF4r"},{displayName:"Morbidity Age",id:"pbvcDRasDav"},{displayName:"Morbidity Cases",id:"t3aNCvHsoSn"},{displayName:"Morbidity Referrals",id:"ck7mRNwGDjP"},{displayName:"Pregnancy complications",id:"Hz71pt7Eb3e"},{displayName:"Project",id:"idcDPkDtepR"},{displayName:"Rural and Urban",id:"DJXmyhnquyI"},{displayName:"Staffing",id:"aN8uN5b15YG"},{displayName:"Stock discarded",id:"WA3HunbaGt0"},{displayName:"Target vs Result",id:"WBW7RjsApsv"},{displayName:"TT",id:"arTwh07V6qz"},{displayName:"Under 5/5 and above",id:"UnNIOt1uB0J"}],m=function(){for(var e,t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];const[,i]=a,{id:n}=i;if(null!==i&&void 0!==i&&null!==(e=i.variables)&&void 0!==e&&e.id){const e=c.find((e=>n===e.id));return Promise.resolve(e)}return Promise.resolve({categoryCombos:c,pager:{page:1,total:23,pageSize:50,pageCount:1}})},u={categoryCombos:m};describe("<CategoryComboSelect />",(()=>{it("should render all options and None (default catCombo)",(async()=>{const e=jest.fn(),t=(0,o.XX)(i.createElement(s.p,{dataForCustomProvider:u},i.createElement(d.R,{onChange:e}))),a=t.getByTestId("dhis2-uicore-select-input");o.rC.click(a);for(let o=0;o<c.length;++o){const e=c[o],a=await t.findByText(e.displayName,{selector:'[data-test="dhis2-uicore-singleselectoption"]'});expect(a).toBeTruthy()}const n=await t.findByText("None",{selector:'[data-test="dhis2-uicore-singleselectoption"]'});expect(n).toBeInTheDocument()})),it('should add an "empty" option when not required',(async()=>{const e=jest.fn(),t={categoryCombos:m},a=(0,o.XX)(i.createElement(s.p,{dataForCustomProvider:t},i.createElement(d.R,{onChange:e}))),n=a.getByTestId("dhis2-uicore-select-input");o.rC.click(n);const r=await a.findByText("None",{selector:'[data-test="dhis2-uicore-singleselectoption"]'}),l=await a.findByText(/No value/,{selector:'[data-test="dhis2-uicore-singleselectoption"]'});expect(r).toBeInTheDocument(),expect(l).toBeInTheDocument(),await(0,o.fm)((()=>{const e=a.getAllByTestId("dhis2-uicore-singleselectoption");expect(e).toHaveLength(c.length+2)}))})),it('should not add an "empty" option when not required',(async()=>{const e=jest.fn(),t={categoryCombos:m},a=(0,o.XX)(i.createElement(s.p,{dataForCustomProvider:t},i.createElement(d.R,{required:!0,onChange:e}))),n=a.getByTestId("dhis2-uicore-select-input");o.rC.click(n),await(0,o.fm)((()=>{const e=a.getAllByTestId("dhis2-uicore-singleselectoption");expect(e).toHaveLength(c.length+1)}))})),it("should load the initially selected option",(async()=>{const e=jest.fn(),t={categoryCombos:m},a=(0,o.XX)(i.createElement(s.p,{dataForCustomProvider:t},i.createElement(d.R,{selected:"m2jTvAj5kkm",onChange:e}))),n=a.getByTestId("dhis2-uicore-select-input");o.rC.click(n);const r=await a.findByText("Births",{selector:".root"});expect(r).toBeTruthy()})),it("should call the onChange handler with the newly selected value",(async()=>{const e=jest.fn(),t={categoryCombos:m},a=(0,o.XX)(i.createElement(s.p,{dataForCustomProvider:t},i.createElement(d.R,{onChange:e}))),n=a.getByTestId("dhis2-uicore-select-input");o.rC.click(n);const r=await a.findByText("Births",{selector:'[data-test="dhis2-uicore-singleselectoption"]'});o.rC.click(r),expect(e).toHaveBeenCalledTimes(1),expect(e).toHaveBeenCalledWith({selected:"m2jTvAj5kkm"})}))}));var p=a(99025);jest.mock("react-final-form",(()=>({...jest.requireActual("react-final-form"),useForm:jest.fn((()=>({change:jest.fn()})))}))),describe("<CategoryComboField />",(()=>{it("should be required",(async()=>{const e={...u},t=jest.fn(),a=(0,r.bg)([{path:"/",element:i.createElement(n.lV,{onSubmit:t,initialValues:{categoryCombo:{id:""}}},(e=>{let{handleSubmit:t}=e;return i.createElement("form",{onSubmit:t},i.createElement(p.CategoryComboField,null),i.createElement("button",{type:"submit"},"Submit"))}))}]),d=(0,o.XX)(i.createElement(s.p,{dataForCustomProvider:e},i.createElement(l.pg,{router:a}))),c=await d.findByText("Submit",{selector:"button"});o.rC.click(c),expect(d.getByTestId("formfields-categorycombo-validation")).toBeTruthy(),expect(t).toHaveBeenCalledTimes(0)})),it("should not be disabled when domainType is not tracker",(()=>{const e={...u},t=jest.fn(),a=(0,r.bg)([{path:"/",element:i.createElement(n.lV,{onSubmit:t,initialValues:{domainType:"AGGREGATE",categoryCombo:{id:""}}},(e=>{let{handleSubmit:t}=e;return i.createElement("form",{onSubmit:t},i.createElement(p.CategoryComboField,null))}))}]),d=(0,o.XX)(i.createElement(s.p,{dataForCustomProvider:e},i.createElement(l.pg,{router:a})));expect(d.container.querySelector(".disabled")).toBeFalsy()})),it("should be disabled when domainType is set to tracker",(async()=>{const e={...u},t=jest.fn(),a=(0,r.bg)([{path:"/",element:i.createElement(n.lV,{onSubmit:t,initialValues:{domainType:"TRACKER",categoryCombo:{id:""}}},(e=>{let{handleSubmit:t}=e;return i.createElement("form",{onSubmit:t},i.createElement(p.CategoryComboField,null))}))}]),d=(0,o.XX)(i.createElement(s.p,{dataForCustomProvider:e},i.createElement(l.pg,{router:a})));expect(d.container.querySelector(".disabled")).toBeTruthy()})),it("should change the value to the default category combo when domainType is set to tracker",(async()=>{const e=jest.fn();n.mN.mockImplementation((()=>({change:e})));const t={...u,categoryCombos:function(){for(var e,t,a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];const[,n]=o;return null!==(e=n.params)&&void 0!==e&&null!==(t=e.filter)&&void 0!==t&&t.includes("isDefault:eq:true")?Promise.resolve({categoryCombos:[{id:"bjDvmb4bfuf"}]}):u.categoryCombos(...o)}},a=jest.fn(),d=(0,r.bg)([{path:"/",element:i.createElement(n.lV,{onSubmit:a,initialValues:{domainType:"TRACKER",categoryCombo:{id:""}}},(e=>{let{handleSubmit:t}=e;return i.createElement("form",{onSubmit:t},i.createElement(p.CategoryComboField,null))}))}]);(0,o.XX)(i.createElement(s.p,{dataForCustomProvider:t},i.createElement(l.pg,{router:d}))),await(0,o.fm)((()=>{expect(e).toHaveBeenCalledTimes(1),expect(e).toHaveBeenCalledWith("categoryCombo.id","bjDvmb4bfuf")}))}))}))},65328:function(e,t,a){"use strict";a.d(t,{p:function(){return d}});var o=a(5292),i=a(72176),n=a(14571),r=a(75204),l=a(34689),s=a(9476);const d=e=>{let{dataForCustomProvider:t,children:a}=e;return i.createElement(o.Kq,{config:{baseUrl:"http://dhis2-imaginary-test-server",apiVersion:41},plugin:!1,parentAlertsAdd:()=>{},showAlertsInPlugin:!0},i.createElement(o.Nh,{data:t,options:{failOnMiss:!0}},a))};t.A=e=>{let{path:t,customData:a,routeOptions:o,children:c}=e;const m=[{path:t,element:i.createElement(d,{dataForCustomProvider:a},i.createElement(l.QueryParamProvider,{adapter:s.S},c)),...o}],u=(0,n.bg)(m,{initialEntries:[t],initialIndex:0});return i.createElement(r.pg,{router:u})}},13240:function(e,t,a){"use strict";a.r(t),t.default={categoryComboSelect:"CategoryComboField_categoryComboSelect__X790g"}},86973:function(){}}]);
//# sourceMappingURL=5824.4c734883.chunk.js.map