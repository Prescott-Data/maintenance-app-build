"use strict";(self.webpackChunk_dhis2_app_shell=self.webpackChunk_dhis2_app_shell||[]).push([[4983,6746,7414,1773,1175,2380,3697,7670,1215],{65703:function(e,t,a){a.r(t),a.d(t,{Component:function(){return h}});var n=a(5292),l=a(28014),i=a(90591),r=a(6866),o=a(72176),s=a(50445),m=a(87899),d=a(49394),c=a(16680),u=a(66920),p=a(7414);const g=`/${(0,c.HR)(c.Vr.dataElement)}`;const f={resource:"dataElements",type:"create",data:e=>e};const h=()=>{const e=(0,n.ow)(),t=(0,c.Qn)(),a=(0,d.yZ)(),i=function(e){const t=(0,c.Ip)(),a=(0,o.useMemo)((()=>e.map((e=>({attribute:e,value:""})))),[e]);return(0,o.useMemo)((()=>{var e;return{name:"",shortName:"",code:"",description:"",url:"",fieldMask:"",domainType:"AGGREGATE",formName:"",valueType:null===(e=t.dataElement.properties.valueType.constants)||void 0===e?void 0:e[0],aggregationType:"NONE",style:{icon:"",color:""},categoryCombo:c.GF,optionSet:{id:""},commentOptionSet:{id:""},legendSets:[],aggregationLevels:[],attributeValues:a,zeroIsSignificant:!1}}),[a,t.dataElement.properties.valueType.constants])}(a.data);return o.createElement(m.aH,{queryResponse:a,label:l.A.t("Custom attributes")},o.createElement(s.lV,{validateOnBlur:!0,onSubmit:async function(a){const n=function(e){var t,a;let{values:n}=e;return{aggregationLevels:n.aggregationLevels,aggregationType:n.aggregationType,attributeValues:n.attributeValues.filter((e=>{let{value:t}=e;return!!t})),categoryCombo:n.categoryCombo.id?n.categoryCombo:void 0,code:n.code,commentOptionSet:n.commentOptionSet.id?n.commentOptionSet:void 0,description:n.description,domainType:n.domainType,fieldMask:n.fieldMask,formName:n.formName,legendSets:n.legendSets,name:n.name,optionSet:n.optionSet.id?n.optionSet:void 0,shortName:n.shortName,style:{color:null===(t=n.style)||void 0===t?void 0:t.color,icon:null===(a=n.style)||void 0===a?void 0:a.icon},url:n.url,valueType:n.valueType,zeroIsSignificant:n.zeroIsSignificant}}({values:a});try{await e.mutate(f,{variables:n})}catch(l){return{[r.Ym]:l.toString()}}t(g)},validate:e=>(0,c.tf)(u.dataElementSchema,e),initialValues:i},(e=>{let{handleSubmit:a,submitting:n,submitError:l}=e;return o.createElement("form",{onSubmit:a},o.createElement(E,{submitError:l,submitting:n,onCancelClick:()=>t(g)}))})))};function E(e){let{submitError:t,onCancelClick:a,submitting:n}=e;const r=(0,o.useRef)(null);return(0,o.useEffect)((()=>{var e;t&&(null===(e=r.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))}),[t]),o.createElement(o.Fragment,null,o.createElement("div",{className:p.default.form},o.createElement(u.DataElementFormFields,null),t&&o.createElement(m.Hl,null,o.createElement("div",{ref:r},o.createElement(i.I,{error:!0,title:l.A.t("Something went wrong when submitting the form")},t))),o.createElement(m.Hl,null,o.createElement(m.Hn,{cancelLabel:l.A.t("Exit without saving"),submitLabel:l.A.t("Create data element"),submitting:n,onCancelClick:a}))))}},63662:function(e,t,a){a.r(t);var n=a(51594),l=a(72176),i=a(14571),r=a(75204),o=a(48763),s=a(31187),m=a(65328),d=a(93483),c=a(81773),u=a(81175),p=a(65703);jest.mock("../../lib/routeUtils/useSectionHandle",(()=>({useSchemaSectionHandleOrThrow:jest.fn((()=>({name:"dataElement",namePlural:"dataElements",parentSectionKey:"dataElement",title:"Data element",titlePlural:"Data elements"})))}))),jest.mock("@dhis2/ui",(()=>({__esModule:!0,...jest.requireActual("@dhis2/ui"),Transfer:()=>l.createElement("div",null)}))),(0,d.p)({componentName:"Data element group set"}),describe("Data Elements / New",(()=>{const e=console.warn;jest.spyOn(console,"warn").mockImplementation((t=>{t.match(/The query should be static/)||e(t)})),s.YH.getState().setSchemas({dataElement:o});const t={attributes:c,categoryCombos:u};it("should return to the list view when cancelling",(async()=>{const e=(0,i.bg)([{path:"/dataElements/new",element:l.createElement(p.Component,null)},{path:"/dataElements",element:l.createElement("div",null,"List view")}],{initialEntries:["/dataElements/new"]}),a=(0,n.XX)(l.createElement(m.p,{dataForCustomProvider:t},l.createElement(r.pg,{router:e}))),o=await a.findByText("Exit without saving",{selector:"button"});expect(a.queryByText("List view")).toBeNull(),n.rC.click(o);const s=await a.findByText("List view");expect(s).toBeTruthy()})),it("should not submit when required values are missing",(async()=>{const e=(0,i.bg)([{path:"/",element:l.createElement(p.Component,null)}]),a=(0,n.XX)(l.createElement(m.p,{dataForCustomProvider:t},l.createElement(r.pg,{router:e}))),o=await a.findByText("Create data element",{selector:"button"});n.rC.click(o);const s=await a.findByText("Required",{selector:'[data-test="formfields-name-validation"]'});expect(s).toBeTruthy();const d=await a.findByText("Required",{selector:'[data-test="formfields-shortname-validation"]'});expect(d).toBeTruthy(),expect(a.container.querySelectorAll('.error[data-test$="-validation"]')).toHaveLength(2)})),it("should submit the data and return to the list view on success",(async()=>{const e=(0,i.bg)([{path:"/dataElements/new",element:l.createElement(p.Component,null)},{path:"/dataElements",element:l.createElement("div",null,"List view")}],{initialIndex:0,initialEntries:["/dataElements/new"]}),a=(0,n.XX)(l.createElement(l.Fragment,null,l.createElement("div",{id:"dhis2-portal-root"}),l.createElement(m.p,{dataForCustomProvider:{...t,dataElements:()=>Promise.resolve({pager:{total:0}})}},l.createElement(r.pg,{router:e})))),o=await a.findByText("Create data element",{selector:"button"});expect(o).toBeTruthy();const s=a.getByRole("textbox",{name:"Name (required) *"});n.rC.change(s,{target:{value:"Data element name"}}),n.rC.blur(s);const d=a.getByRole("textbox",{name:"Short name (required) *"});n.rC.change(d,{target:{value:"Data element short name"}}),n.rC.blur(d),await async function(e,t,a){var l;const i=null===(l=(await e.findByText(t)).parentNode)||void 0===l?void 0:l.parentNode;expect(i).toBeTruthy();const r=i.querySelector('[data-test="dhis2-uicore-select-input"].root');expect(r).toBeTruthy(),n.rC.click(r),await e.findByTestId("dhis2-uicore-layer");const o=await e.findByText(a,{selector:"[data-value]"});n.rC.click(o)}(a,"Category combination (required)","None"),n.rC.click(o);const c=await a.findByText("List view");expect(c).toBeTruthy()})),it("contain all needed field",(()=>{})),it("should show an error if name field is too long",(()=>{})),it("should show an error if short name field is too long",(()=>{})),it("should show an error if code field is too long",(()=>{})),it("should show an error if description field is too long",(()=>{})),it("should show an error if name field is a duplicate",(()=>{})),it("should show an error if short name field is a duplicate",(()=>{})),it("should show an error if code field is a duplicate",(()=>{}))}))},84235:function(e,t,a){a.r(t),a.d(t,{DataElementFormFields:function(){return m}});var n=a(28014),l=a(72176),i=a(87899),r=a(49394),o=a(16680),s=a(37591);function m(){const e=o.Vr.dataElement;return l.createElement(l.Fragment,null,l.createElement(i.Hl,null,l.createElement(i.L7,null,n.A.t("Basic information")),l.createElement(i.hK,null,n.A.t("Set up the information for this data element")),l.createElement(i.Ys,null,l.createElement(r.om,{schemaSection:e})),l.createElement(i.Ys,null,l.createElement(r.Uu,{schemaSection:e})),l.createElement(i.Ys,null,l.createElement(s.FormNameField,null)),l.createElement(i.Ys,null,l.createElement(r.Ij,{schemaSection:e})),l.createElement(i.Ys,null,l.createElement(r.zO,{helpText:n.A.t("Explain the purpose of this data element."),schemaSection:e})),l.createElement(i.Ys,null,l.createElement(s.UrlField,null)),l.createElement(i.Ys,null,l.createElement(s.ColorAndIconField,null)),l.createElement(i.Ys,null,l.createElement(s.FieldMaskField,null)),l.createElement(i.Ys,null,l.createElement(s.ZeroIsSignificantField,null)),l.createElement(i.Ys,null,l.createElement(s.DomainField,null)),l.createElement(i.Ys,null,l.createElement(s.ValueTypeField,null)),l.createElement(i.Ys,null,l.createElement(s.AggregationTypeField,null))),l.createElement(i.Hl,null,l.createElement(i.L7,null,n.A.t("Disaggregation and Option sets")),l.createElement(i.hK,null,n.A.t("Set up disaggregation and predefined options.")),l.createElement(i.Ys,null,l.createElement(s.CategoryComboField,null)),l.createElement(i.Ys,null,l.createElement(s.OptionSetField,null)),l.createElement(i.Ys,null,l.createElement(s.OptionSetCommentField,null))),l.createElement(i.Hl,null,l.createElement(i.L7,null,n.A.t("Legend set")),l.createElement(i.hK,null,n.A.t("Visualize values for this data element in Analytics app. Multiple legendSet can be applied.")),l.createElement(i.Ys,null,l.createElement(s.LegendSetField,null))),l.createElement(i.Hl,null,l.createElement(i.L7,null,n.A.t("Aggregation levels")),l.createElement(i.hK,null,n.A.t('By default, the aggregation will start at the lowest assigned organisation unit. If you for example select "Chiefdom", it means that "Chiefdom", "District" and "National" aggregates use "Chiefdom" (the highest aggregation level available) as the data source, and PHU data will not be included. PHU will still be available for the PHU level, but not included in the aggregations to the levels above.')),l.createElement(i.Ys,null,l.createElement(s.AggregationLevelsField,null))),l.createElement(i.Ot,{schemaSection:e}))}},41215:function(e,t,a){a.r(t),a.d(t,{dataElementSchema:function(){return l}});var n=a(73044);const l=n.z.object({name:n.z.string().trim(),shortName:n.z.string().trim(),code:n.z.string().trim(),description:n.z.string().trim(),formName:n.z.string().trim(),url:n.z.string().trim(),fieldMask:n.z.string().trim(),style:n.z.object({color:n.z.string().optional(),icon:n.z.string().optional()}),domainType:n.z.union([n.z.literal("AGGREGATE"),n.z.literal("TRACKER")]),valueType:n.z.string(),aggregationType:n.z.string(),optionSet:n.z.object({id:n.z.string()}),commentOptionSet:n.z.object({id:n.z.string()}),legendSets:n.z.array(n.z.object({id:n.z.string()})),aggregationLevels:n.z.array(n.z.number()),attributeValues:n.z.array(n.z.object({value:n.z.string().optional(),attribute:n.z.object({id:n.z.string()})}))}).partial()},66920:function(e,t,a){a.r(t),a.d(t,{DataElementFormFields:function(){return n.DataElementFormFields},dataElementSchema:function(){return l.dataElementSchema}});var n=a(84235),l=a(41215)},93483:function(e,t,a){a.d(t,{m:function(){return l},p:function(){return n}});const n=e=>{let{componentName:t}=e;xdescribe(`${t} default add form tests`,(()=>{it("should should return to the list view when cancelling",(()=>{})),it("should show a loader while the form is being submitted ",(()=>{}))}))},l=e=>{let{componentName:t}=e;xdescribe(`${t} default add form tests`,(()=>{it("should should return to the list view when cancelling",(()=>{})),it("should show a loader while the form is being submitted ",(()=>{}))}))}},7414:function(e,t,a){a.r(t),t.default={form:"New_form__hR0MF"}},81773:function(e){e.exports=JSON.parse('[{"valueType":"TEXT","mandatory":false,"optionSet":{"options":[{"code":"INPUT","name":"Input","displayName":"Input","id":"Fr4igNnPYTv"},{"code":"ACTIVITY","name":"Activity","displayName":"Activity","id":"xuAA8BQjdZq"},{"code":"OUTPUT","name":"Output","displayName":"Output","id":"tpJ71rNdmeo"},{"code":"IMPACT","name":"Impact","displayName":"Impact","id":"QIbgv5M77In"}]},"displayFormName":"Classification","id":"Z4X3J7jMLYV"},{"valueType":"LONG_TEXT","mandatory":false,"displayFormName":"Collection method","id":"qXS2NDUEAOS"},{"valueType":"TEXT","mandatory":false,"displayFormName":"NGO ID","id":"n2xYlNbsfko"},{"valueType":"TEXT","mandatory":false,"displayFormName":"PEPFAR ID","id":"dLHLR5O4YFI"},{"valueType":"TEXT","mandatory":false,"displayFormName":"Rationale","id":"AhsCAtM3L0g"},{"valueType":"TEXT","mandatory":false,"displayFormName":"Unit of measure","id":"Y1LUDU8sWBR"}]')},81175:function(e){e.exports=JSON.parse('{"pager":{"page":1,"total":23,"pageSize":10,"nextPage":"https://debug.dhis2.org/dev/api/41/categoryCombos?page=2&pageSize=10&fields=id%2CdisplayName%2CisDefault&order=isDefault%3Adesc%2CdisplayName","pageCount":3},"categoryCombos":[{"displayName":"Births","id":"m2jTvAj5kkm","isDefault":false},{"displayName":"Commodities","id":"gbvX3pogf7p","isDefault":false},{"displayName":"Fixed/Outreach","id":"KYYSTxeVw28","isDefault":false},{"displayName":"Gender","id":"dPmavA0qloX","isDefault":false},{"displayName":"HIV Paed age+gender","id":"v1K6CE6bmtw","isDefault":false},{"displayName":"HIV age","id":"Wfan7UwK8CQ","isDefault":false},{"displayName":"HIV age+gender","id":"jCNGsC2NawV","isDefault":false},{"displayName":"Implementing Partner","id":"nM3u9s5a52V","isDefault":false},{"displayName":"Implementing Partner and Projects","id":"O4VaNks6tta","isDefault":false}]}')}}]);
//# sourceMappingURL=4983.6c232b10.chunk.js.map