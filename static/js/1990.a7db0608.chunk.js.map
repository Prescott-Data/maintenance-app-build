{"version":3,"file":"static/js/1990.a7db0608.chunk.js","mappings":"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","sources":["D2App/pages/dataElements/fields/ValueTypeField.js","D2App/pages/dataElements/fields/ValueTypeField.test.js"],"sourcesContent":["import i18n from '@dhis2/d2-i18n';\nimport { SingleSelectFieldFF } from '@dhis2/ui';\nimport React, { useEffect, useState } from 'react';\nimport { Field as FieldRFF, useForm, useFormState } from 'react-final-form';\nimport { VALUE_TYPE, required, useSchemas, useOptionSetQuery } from '../../../lib';\n\n/**\n * Field rule: Unless valueType or the selected optionSet's valueType is\n *             MULTI_TEXT, filter out the MULTI_TEXT option\n * Field rule: When the selected optionSet's valueType is MULTI_TEXT, disable\n *             valueType field\n * Field rule: When the selected optionSet's valueType is MULTI_TEXT, set\n *             valueTypeField value to optionSet's valueType\n */\nconst valueTypeHelpText = i18n.t('The type of data that will be recorded.');\nconst valueTypeDisabledHelpText = i18n.t('Disabled as the value type must match the value type of the selected option set');\nconst valueTypeOptionSetFields = ['id', 'valueType'];\nexport function ValueTypeField() {\n  var _values$optionSet, _optionSetQuery$data3, _dataElement$properti;\n  const {\n    change\n  } = useForm();\n  const {\n    values\n  } = useFormState({\n    subscription: {\n      values: true\n    }\n  });\n  const disabled = !!values.optionSet.id;\n  const [lazy] = useState(!values.optionSet.id);\n  const {\n    refetch,\n    ...optionSetQuery\n  } = useOptionSetQuery({\n    lazy,\n    variables: {\n      id: values.optionSet.id,\n      fields: valueTypeOptionSetFields\n    }\n  });\n  useEffect(() => {\n    if (values.optionSet.id) {\n      refetch({\n        id: values.optionSet.id\n      });\n    }\n  }, [refetch, values.optionSet.id]);\n  useEffect(() => {\n    var _optionSetQuery$data;\n    if (values.optionSet.id && !optionSetQuery.loading && !optionSetQuery.fetching && !optionSetQuery.error && (_optionSetQuery$data = optionSetQuery.data) !== null && _optionSetQuery$data !== void 0 && _optionSetQuery$data.optionSets.valueType) {\n      var _optionSetQuery$data2;\n      change('valueType', (_optionSetQuery$data2 = optionSetQuery.data) === null || _optionSetQuery$data2 === void 0 ? void 0 : _optionSetQuery$data2.optionSets.valueType);\n    }\n  });\n  const schemas = useSchemas();\n  const {\n    dataElement\n  } = schemas;\n  const optionSetHasMultiTextValueType = values.valueType === 'MULTI_TEXT' || ((_values$optionSet = values.optionSet) === null || _values$optionSet === void 0 ? void 0 : _values$optionSet.id) && ((_optionSetQuery$data3 = optionSetQuery.data) === null || _optionSetQuery$data3 === void 0 ? void 0 : _optionSetQuery$data3.optionSets.valueType) === 'MULTI_TEXT';\n  const options = (_dataElement$properti = dataElement.properties.valueType.constants) === null || _dataElement$properti === void 0 ? void 0 : _dataElement$properti.map(constant => ({\n    value: constant,\n    label: VALUE_TYPE[constant]\n  })).filter(_ref => {\n    let {\n      value\n    } = _ref;\n    return optionSetHasMultiTextValueType || value !== 'MULTI_TEXT';\n  });\n  const helpText = disabled ? `${valueTypeHelpText} ${valueTypeDisabledHelpText}` : valueTypeHelpText;\n  return /*#__PURE__*/React.createElement(FieldRFF, {\n    required: true,\n    disabled: disabled,\n    component: SingleSelectFieldFF,\n    dataTest: \"formfields-valuetype\",\n    inputWidth: \"400px\",\n    name: \"valueType\",\n    label: i18n.t('{{fieldLabel}} (required)', {\n      fieldLabel: i18n.t('Value type')\n    }),\n    helpText: helpText,\n    options: options || [],\n    validateFields: [],\n    validate: required\n  });\n}","import { render, fireEvent } from '@testing-library/react';\nimport React from 'react';\nimport { Form } from 'react-final-form';\nimport { VALUE_TYPE, useSchemas, useOptionSetQuery } from '../../../lib';\nimport { ValueTypeField } from './ValueTypeField';\njest.mock('../../../lib/optionSet/useOptionSetQuery', () => ({\n  useOptionSetQuery: jest.fn()\n}));\njest.mock('../../../lib/schemas/schemaStore', () => {\n  return {\n    ...jest.requireActual('../../../lib/schemas/schemaStore'),\n    useSchemas: jest.fn()\n  };\n});\nconst valueTypes = Object.keys(VALUE_TYPE);\ndescribe('<ValueTypeField />', () => {\n  // `(useOptionSetQuery as jest.Mock).mockImplementation` causes the code to be\n  // built wrongly and subsequently to bug out\n  const uOSQ = useOptionSetQuery;\n  const uS = useSchemas;\n  uS.mockImplementation(() => ({\n    dataElement: {\n      properties: {\n        valueType: {\n          constants: valueTypes\n        }\n      }\n    }\n  }));\n  it('should not have the MULTI_TEXT option when a different value is selected', async () => {\n    uOSQ.mockImplementation(() => ({\n      called: false,\n      loading: false,\n      fetching: false,\n      error: null,\n      data: null,\n      refetch: jest.fn()\n    }));\n    const initialValues = {\n      valueType: '',\n      optionSet: []\n    };\n    const result = render( /*#__PURE__*/React.createElement(Form, {\n      onSubmit: jest.fn(),\n      initialValues: initialValues\n    }, _ref => {\n      let {\n        handleSubmit\n      } = _ref;\n      return /*#__PURE__*/React.createElement(\"form\", {\n        onSubmit: handleSubmit\n      }, /*#__PURE__*/React.createElement(ValueTypeField, null));\n    }));\n    const label = await result.findByTestId('dhis2-uicore-select-input');\n    fireEvent.click(label);\n    const textOption = await result.findByText('Text', {\n      selector: '[data-test=\"dhis2-uicore-singleselectoption\"]'\n    });\n    expect(textOption).toBeTruthy();\n    const multiTextOption = result.queryByText('Text with multiple values', {\n      selector: '[data-test=\"dhis2-uicore-singleselectoption\"]'\n    });\n    expect(multiTextOption).toBeFalsy();\n  });\n  it('should have the MULTI_TEXT option when the selected value is MULTI_TEXT', async () => {\n    const mockResult = {\n      called: false,\n      loading: false,\n      fetching: false,\n      error: null,\n      data: null,\n      refetch: jest.fn()\n    };\n    uOSQ.mockImplementation(() => mockResult);\n    const initialValues = {\n      valueType: 'MULTI_TEXT',\n      optionSet: []\n    };\n    const result = render( /*#__PURE__*/React.createElement(Form, {\n      onSubmit: jest.fn(),\n      initialValues: initialValues\n    }, _ref2 => {\n      let {\n        handleSubmit\n      } = _ref2;\n      return /*#__PURE__*/React.createElement(\"form\", {\n        onSubmit: handleSubmit\n      }, /*#__PURE__*/React.createElement(ValueTypeField, null));\n    }));\n    const label = await result.findByTestId('dhis2-uicore-select-input');\n    fireEvent.click(label);\n    await result.findByText('Text', {\n      selector: '[data-test=\"dhis2-uicore-singleselectoption\"]'\n    });\n    const multiTextOption = result.queryByText('Text with multiple values', {\n      selector: '[data-test=\"dhis2-uicore-singleselectoption\"]'\n    });\n    expect(multiTextOption).toBeTruthy();\n  });\n  it(\"should have the MULTI_TEXT option auto-selected when the option set's valueType is MULTI_TEXT\", async () => {\n    const mockResult = {\n      called: false,\n      loading: false,\n      fetching: false,\n      error: null,\n      data: {\n        optionSets: {\n          id: 'foo',\n          valueType: 'MULTI_TEXT'\n        }\n      },\n      refetch: jest.fn()\n    };\n    uOSQ.mockImplementation(() => mockResult);\n    const initialValues = {\n      valueType: 'TEXT',\n      optionSet: {\n        id: 'foo'\n      }\n    };\n    const result = render( /*#__PURE__*/React.createElement(Form, {\n      onSubmit: jest.fn(),\n      initialValues: initialValues\n    }, _ref3 => {\n      let {\n        handleSubmit\n      } = _ref3;\n      return /*#__PURE__*/React.createElement(\"form\", {\n        onSubmit: handleSubmit\n      }, /*#__PURE__*/React.createElement(ValueTypeField, null));\n    }));\n    const multiTextOption = await result.findByText('Text with multiple values');\n    expect(multiTextOption).toBeTruthy();\n  });\n});"],"names":["valueTypeHelpText","i18n","t","valueTypeDisabledHelpText","valueTypeOptionSetFields","ValueTypeField","_values$optionSet","_optionSetQuery$data3","_dataElement$properti","change","useForm","values","useFormState","subscription","disabled","optionSet","id","lazy","useState","refetch","optionSetQuery","useOptionSetQuery","variables","fields","useEffect","_optionSetQuery$data","_optionSetQuery$data2","loading","fetching","error","data","optionSets","valueType","schemas","useSchemas","dataElement","optionSetHasMultiTextValueType","options","properties","constants","map","constant","value","label","VALUE_TYPE","filter","_ref","helpText","React","FieldRFF","required","component","SingleSelectFieldFF","dataTest","inputWidth","name","fieldLabel","validateFields","validate","jest","mock","fn","requireActual","valueTypes","Object","keys","describe","uOSQ","mockImplementation","it","async","called","result","render","Form","onSubmit","initialValues","handleSubmit","findByTestId","fireEvent","click","textOption","findByText","selector","expect","toBeTruthy","multiTextOption","queryByText","toBeFalsy","mockResult","_ref2","_ref3"],"sourceRoot":""}