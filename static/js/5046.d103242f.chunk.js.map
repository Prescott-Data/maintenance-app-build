{"version":3,"file":"static/js/5046.d103242f.chunk.js","mappings":"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","sources":["D2App/pages/categoryCombos/form/CategoriesField.js","D2App/pages/categoryCombos/form/CategoryComboFormFields.js","D2App/pages/categoryCombos/form/categoryComboSchema.js","D2App/pages/categoryCombos/form/useIdenticalCategoryCombosQuery.js","webpack://@dhis2/app-shell/./src/D2App/pages/categoryCombos/form/CategoryCombo.module.css?4dbb"],"sourcesContent":["import i18n from '@dhis2/d2-i18n';\nimport { Field, NoticeBox } from '@dhis2/ui';\nimport React from 'react';\nimport { useField } from 'react-final-form';\nimport { NavLink, useParams } from 'react-router-dom';\nimport { ModelTransfer } from '../../../components';\nimport css from './CategoryCombo.module.css';\nimport { useIdenticalCategoryCombosQuery } from './useIdenticalCategoryCombosQuery';\nconst query = {\n  resource: 'categories',\n  params: {\n    fields: ['id', 'displayName', 'categoryOptions~size~rename(categoryOptionsSize)'],\n    order: 'displayName:asc',\n    filter: ['name:ne:default']\n  }\n};\nconst fieldName = 'categories';\nconst numberFormat = new Intl.NumberFormat();\nexport function CategoriesField() {\n  var _useParams, _input$value, _meta$error;\n  const catComboId = (_useParams = useParams()) === null || _useParams === void 0 ? void 0 : _useParams.id;\n  const {\n    input,\n    meta\n  } = useField(fieldName, {\n    multiple: true,\n    validateFields: []\n  });\n  const generatedCocsCount = ((_input$value = input.value) === null || _input$value === void 0 ? void 0 : _input$value.reduce((acc, cat) => acc * cat.categoryOptionsSize, 1)) || 0;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: css.categoriesFieldWrapper\n  }, /*#__PURE__*/React.createElement(Field, {\n    dataTest: \"formfields-modeltransfer\",\n    error: meta.invalid,\n    validationText: meta.touched && ((_meta$error = meta.error) === null || _meta$error === void 0 ? void 0 : _meta$error.toString()) || '',\n    name: fieldName\n  }, /*#__PURE__*/React.createElement(ModelTransfer, {\n    selected: input.value,\n    onChange: _ref => {\n      let {\n        selected\n      } = _ref;\n      input.onChange(selected);\n      input.onBlur();\n    },\n    leftHeader: i18n.t('Available categories'),\n    rightHeader: i18n.t('Selected categories'),\n    filterPlaceholder: i18n.t('Filter available categories'),\n    filterPlaceholderPicked: i18n.t('Filter selected categories'),\n    query: query,\n    maxSelections: 200\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: css.categoriesNoticesWrapper\n  }, !catComboId && generatedCocsCount > 1 && /*#__PURE__*/React.createElement(NoticeBox, {\n    warning: generatedCocsCount > 250\n  }, i18n.t('{{count}} category option combinations will be generated.', {\n    count: numberFormat.format(generatedCocsCount)\n  })), /*#__PURE__*/React.createElement(CategoriesFieldWarnings, {\n    catComboId: catComboId,\n    selectedCategories: input.value\n  })));\n}\nconst CategoriesFieldWarnings = _ref2 => {\n  var _identicalCatCombosRe;\n  let {\n    selectedCategories,\n    catComboId\n  } = _ref2;\n  const isMoreThanRecommended = selectedCategories.length > 4;\n  const identicalCatCombosResult = useIdenticalCategoryCombosQuery({\n    categoryComboId: catComboId,\n    selectedCategories,\n    enabled: !isMoreThanRecommended\n  });\n  const isIdenticalCatCombos = identicalCatCombosResult.isSuccess && ((_identicalCatCombosRe = identicalCatCombosResult.data) === null || _identicalCatCombosRe === void 0 ? void 0 : _identicalCatCombosRe.pager.total) > 0;\n  if (!isMoreThanRecommended && !isIdenticalCatCombos) {\n    return null;\n  }\n  return /*#__PURE__*/React.createElement(React.Fragment, null, isIdenticalCatCombos && /*#__PURE__*/React.createElement(IdenticalCategoryComboWarning, {\n    categoryCombos: identicalCatCombosResult.data.categoryCombos\n  }), isMoreThanRecommended && /*#__PURE__*/React.createElement(NoticeBox, {\n    warning: true,\n    title: i18n.t('More than 4 Categories')\n  }, i18n.t('A Category combination with more than 4 categories is not recommended.')));\n};\nconst IdenticalCategoryComboWarning = _ref3 => {\n  let {\n    categoryCombos\n  } = _ref3;\n  return /*#__PURE__*/React.createElement(NoticeBox, {\n    warning: true,\n    title: i18n.t('Identical Category Combination')\n  }, i18n.t(`One or more Category combinations with the same categories already exist in the system. \n        It is strongly discouraged to have more than one Category combination with the same categories.`), /*#__PURE__*/React.createElement(\"br\", null), i18n.t('The following Category combinations have identical categories:'), /*#__PURE__*/React.createElement(\"ul\", {\n    className: css.identicalCategoriesList\n  }, categoryCombos.map(catCombo => /*#__PURE__*/React.createElement(\"li\", {\n    key: catCombo.id\n  }, /*#__PURE__*/React.createElement(NavLink, {\n    target: \"_blank\",\n    to: `../${catCombo.id}`\n  }, catCombo.displayName)))));\n};","import i18n from '@dhis2/d2-i18n';\nimport { CheckboxFieldFF, RadioFieldFF } from '@dhis2/ui';\nimport React from 'react';\nimport { Field } from 'react-final-form';\nimport { useParams } from 'react-router-dom';\nimport { StandardFormField, StandardFormSection, StandardFormSectionTitle, StandardFormSectionDescription, HorizontalFieldGroup, NameField, CodeField } from '../../../components';\nimport { SECTIONS_MAP } from '../../../lib';\nimport { CategoriesField } from './CategoriesField';\nconst section = SECTIONS_MAP.categoryCombo;\nexport const CategoryComboFormFields = () => {\n  const isNewForm = useParams().id === undefined;\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(StandardFormSection, null, /*#__PURE__*/React.createElement(StandardFormSectionTitle, null, i18n.t('Basic information')), /*#__PURE__*/React.createElement(StandardFormSectionDescription, null, i18n.t('Set up the basic information for this category.')), /*#__PURE__*/React.createElement(StandardFormField, null, /*#__PURE__*/React.createElement(NameField, {\n    schemaSection: section\n  })), /*#__PURE__*/React.createElement(StandardFormField, null, /*#__PURE__*/React.createElement(CodeField, {\n    schemaSection: section\n  }))), /*#__PURE__*/React.createElement(StandardFormSection, null, /*#__PURE__*/React.createElement(StandardFormSectionTitle, null, i18n.t('Data configuration')), /*#__PURE__*/React.createElement(StandardFormSectionDescription, null, i18n.t('Choose how this category combo will be used to capture and analyze data.')), /*#__PURE__*/React.createElement(StandardFormField, null, /*#__PURE__*/React.createElement(HorizontalFieldGroup, {\n    label: 'Data dimension type (required)'\n  }, /*#__PURE__*/React.createElement(Field, {\n    name: \"dataDimensionType\",\n    component: RadioFieldFF,\n    label: i18n.t('Disaggregation'),\n    type: \"radio\",\n    value: 'DISAGGREGATION',\n    disabled: !isNewForm\n  }), /*#__PURE__*/React.createElement(Field, {\n    name: \"dataDimensionType\",\n    component: RadioFieldFF,\n    label: i18n.t('Attribute'),\n    type: \"radio\",\n    value: 'ATTRIBUTE',\n    disabled: !isNewForm\n  }))), /*#__PURE__*/React.createElement(StandardFormField, null, /*#__PURE__*/React.createElement(Field, {\n    name: \"skipTotal\",\n    type: \"checkbox\",\n    component: CheckboxFieldFF,\n    label: i18n.t('Skip category total in reports')\n  }))), /*#__PURE__*/React.createElement(StandardFormSection, null, /*#__PURE__*/React.createElement(StandardFormSectionTitle, null, /*#__PURE__*/React.createElement(\"label\", {\n    htmlFor: \"categories\"\n  }, i18n.t('Categories'))), /*#__PURE__*/React.createElement(StandardFormSectionDescription, null, i18n.t('Choose the categories to include in this category combo.')), /*#__PURE__*/React.createElement(StandardFormField, null, /*#__PURE__*/React.createElement(CategoriesField, null))));\n};","import i18n from '@dhis2/d2-i18n';\nimport { z } from 'zod';\nimport { getDefaults, modelFormSchemas } from '../../../lib';\nimport { createFormValidate } from '../../../lib/form/validate';\nimport { CategoryCombo } from './../../../types/generated/models';\nconst {\n  identifiable,\n  withAttributeValues,\n  modelReference\n} = modelFormSchemas;\nconst GENERATED_COC_LIMIT = 50000;\nexport const categoryComboSchema = identifiable.merge(withAttributeValues).extend({\n  code: z.string().trim().optional(),\n  dataDimensionType: z.nativeEnum(CategoryCombo.dataDimensionType).default(CategoryCombo.dataDimensionType.DISAGGREGATION),\n  skipTotal: z.boolean().default(false),\n  categories: z.array(modelReference.extend({\n    displayName: z.string(),\n    categoryOptionsSize: z.number()\n  })).min(1, i18n.t('At least one category is required')).refine(categories => {\n    const generatedCocsCount = categories.reduce((acc, category) => acc * category.categoryOptionsSize, 1);\n    return generatedCocsCount < GENERATED_COC_LIMIT;\n  }, {\n    message: i18n.t('The number of generated category option combinations exceeds the limit of {{limit}}', {\n      limit: GENERATED_COC_LIMIT\n    })\n  }).default([])\n});\nexport const initialValues = getDefaults(categoryComboSchema);\nexport const validate = createFormValidate(categoryComboSchema);","import { useQuery } from 'react-query';\nimport { useBoundResourceQueryFn } from '../../../lib/query/useBoundQueryFn';\nexport const useIdenticalCategoryCombosQuery = _ref => {\n  let {\n    categoryComboId,\n    selectedCategories,\n    ...queryOptions\n  } = _ref;\n  const queryFn = useBoundResourceQueryFn();\n  const notSameCatComboFilter = `id:ne:${categoryComboId}`;\n  const idFilters = selectedCategories.map(category => `categories.id:eq:${category.id}`);\n  const lengthFilter = `categories:eq:${selectedCategories.length}`;\n  const filters = [lengthFilter, ...idFilters];\n  if (categoryComboId) {\n    filters.push(notSameCatComboFilter);\n  }\n  const useIdenticalCategoryCombosQuery = {\n    resource: 'categoryCombos',\n    params: {\n      fields: ['id', 'displayName'],\n      filter: filters\n    }\n  };\n  return useQuery({\n    staleTime: 60 * 1000,\n    ...queryOptions,\n    queryKey: [useIdenticalCategoryCombosQuery],\n    queryFn: queryFn\n  });\n};","// extracted by mini-css-extract-plugin\nexport default {\"categoriesFieldWrapper\":\"CategoryCombo_categoriesFieldWrapper__00djY\",\"categoriesNoticesWrapper\":\"CategoryCombo_categoriesNoticesWrapper__R4Myf\",\"identicalCategoriesList\":\"CategoryCombo_identicalCategoriesList__chLzG\"};"],"names":["query","resource","params","fields","order","filter","fieldName","numberFormat","Intl","NumberFormat","CategoriesField","_useParams","_input$value","_meta$error","catComboId","useParams","id","input","meta","useField","multiple","validateFields","generatedCocsCount","value","reduce","acc","cat","categoryOptionsSize","React","className","css","categoriesFieldWrapper","Field","dataTest","error","invalid","validationText","touched","toString","name","ModelTransfer","selected","onChange","_ref","onBlur","leftHeader","i18n","t","rightHeader","filterPlaceholder","filterPlaceholderPicked","maxSelections","categoriesNoticesWrapper","NoticeBox","warning","count","format","CategoriesFieldWarnings","selectedCategories","_ref2","_identicalCatCombosRe","isMoreThanRecommended","length","identicalCatCombosResult","useIdenticalCategoryCombosQuery","categoryComboId","enabled","isIdenticalCatCombos","isSuccess","data","pager","total","IdenticalCategoryComboWarning","categoryCombos","title","_ref3","identicalCategoriesList","map","catCombo","key","NavLink","target","to","displayName","section","SECTIONS_MAP","categoryCombo","CategoryComboFormFields","isNewForm","undefined","StandardFormSection","StandardFormSectionTitle","StandardFormSectionDescription","StandardFormField","NameField","schemaSection","CodeField","HorizontalFieldGroup","label","component","RadioFieldFF","type","disabled","CheckboxFieldFF","htmlFor","identifiable","withAttributeValues","modelReference","modelFormSchemas","categoryComboSchema","merge","extend","code","z","string","trim","optional","dataDimensionType","nativeEnum","CategoryCombo","default","DISAGGREGATION","skipTotal","boolean","categories","array","number","min","refine","category","message","limit","initialValues","getDefaults","validate","createFormValidate","queryOptions","queryFn","useBoundResourceQueryFn","notSameCatComboFilter","idFilters","filters","push","useQuery","staleTime","queryKey"],"sourceRoot":""}