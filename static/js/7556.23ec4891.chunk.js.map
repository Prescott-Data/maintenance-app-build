{"version":3,"file":"static/js/7556.23ec4891.chunk.js","mappings":"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","sources":["D2App/pages/dataElementGroupSets/New.js","D2App/pages/dataElementGroupSets/fields/CompulsoryField.js","D2App/pages/dataElementGroupSets/fields/DataDimensionField.js","D2App/pages/dataElementGroupSets/fields/DataElementGroupsField.js","D2App/pages/dataElementGroupSets/form/DataElementGroupSetFormFields.js","D2App/pages/dataElementGroupSets/form/dataElementGroupSetSchema.js","webpack://@dhis2/app-shell/./src/D2App/pages/dataElementGroupSets/New.module.css?4539","webpack://@dhis2/app-shell/./src/D2App/pages/dataElementGroupSets/fields/DataElementGroupsField.module.css?f983"],"sourcesContent":["import { useDataEngine } from '@dhis2/app-runtime';\nimport i18n from '@dhis2/d2-i18n';\nimport { NoticeBox } from '@dhis2/ui';\nimport { FORM_ERROR } from 'final-form';\nimport React, { useEffect, useMemo, useRef } from 'react';\nimport { Form } from 'react-final-form';\nimport { useNavigate } from 'react-router-dom';\nimport { Loader, StandardFormActions, StandardFormSection } from '../../components';\nimport { useCustomAttributesQuery } from '../../components/form';\nimport { SCHEMA_SECTIONS, getSectionPath, validate } from '../../lib';\nimport { DataElementGroupSetFormFields, dataElementGroupSetSchema } from './form';\nimport classes from './New.module.css';\nconst listPath = `/${getSectionPath(SCHEMA_SECTIONS.dataElementGroupSet)}`;\nfunction useInitialValues(customAttributes) {\n  const attributeValues = useMemo(() => customAttributes.map(attribute => ({\n    attribute,\n    value: ''\n  })), [customAttributes]);\n  return {\n    name: '',\n    shortName: '',\n    code: '',\n    description: '',\n    compulsory: false,\n    dataDimension: false,\n    dataElementGroups: [],\n    attributeValues\n  };\n}\nconst ADD_NEW_DATA_ELEMENT_GROUP_MUTATION = {\n  resource: 'dataElementGroupSets',\n  type: 'create',\n  data: de => de\n};\nexport function Component() {\n  const dataEngine = useDataEngine();\n  const navigate = useNavigate();\n  const customAttributesQuery = useCustomAttributesQuery();\n  const initialValues = useInitialValues(customAttributesQuery.data);\n  const onSubmit = async payload => {\n    try {\n      // We want the promise so we know when submitting is done. The promise\n      // returned by the mutation function of useDataMutation will never\n      // resolve\n      await dataEngine.mutate(ADD_NEW_DATA_ELEMENT_GROUP_MUTATION, {\n        variables: payload\n      });\n    } catch (e) {\n      return {\n        [FORM_ERROR]: e.toString()\n      };\n    }\n    navigate(listPath);\n  };\n  return /*#__PURE__*/React.createElement(Loader, {\n    queryResponse: customAttributesQuery,\n    label: i18n.t('Custom attributes')\n  }, /*#__PURE__*/React.createElement(Form, {\n    validateOnBlur: true,\n    onSubmit: onSubmit,\n    validate: values => {\n      return validate(dataElementGroupSetSchema, values);\n    },\n    initialValues: initialValues\n  }, _ref => {\n    let {\n      handleSubmit,\n      submitting,\n      submitError\n    } = _ref;\n    return /*#__PURE__*/React.createElement(\"form\", {\n      onSubmit: handleSubmit\n    }, /*#__PURE__*/React.createElement(FormContents, {\n      submitError: submitError,\n      submitting: submitting,\n      onCancelClick: () => navigate(listPath)\n    }));\n  }));\n}\nfunction FormContents(_ref2) {\n  let {\n    submitError,\n    onCancelClick,\n    submitting\n  } = _ref2;\n  const formErrorRef = useRef(null);\n  useEffect(() => {\n    if (submitError) {\n      var _formErrorRef$current;\n      (_formErrorRef$current = formErrorRef.current) === null || _formErrorRef$current === void 0 ? void 0 : _formErrorRef$current.scrollIntoView({\n        behavior: 'smooth'\n      });\n    }\n  }, [submitError]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.form\n  }, /*#__PURE__*/React.createElement(DataElementGroupSetFormFields, null), submitError && /*#__PURE__*/React.createElement(StandardFormSection, null, /*#__PURE__*/React.createElement(\"div\", {\n    ref: formErrorRef\n  }, /*#__PURE__*/React.createElement(NoticeBox, {\n    error: true,\n    title: i18n.t('Something went wrong when submitting the form')\n  }, submitError))), /*#__PURE__*/React.createElement(StandardFormSection, null, /*#__PURE__*/React.createElement(StandardFormActions, {\n    cancelLabel: i18n.t('Exit without saving'),\n    submitLabel: i18n.t('Create data element group'),\n    submitting: submitting,\n    onCancelClick: onCancelClick\n  }))));\n}","import i18n from '@dhis2/d2-i18n';\nimport { CheckboxFieldFF } from '@dhis2/ui';\nimport React from 'react';\nimport { Field as FieldRFF } from 'react-final-form';\nexport function CompulsoryField() {\n  return /*#__PURE__*/React.createElement(FieldRFF, {\n    component: CheckboxFieldFF,\n    dataTest: \"dataelementsformfields-compulsory\",\n    name: \"compulsory\",\n    label: i18n.t('Compulsory'),\n    type: \"checkbox\",\n    validateFields: []\n  });\n}","import i18n from '@dhis2/d2-i18n';\nimport { CheckboxFieldFF } from '@dhis2/ui';\nimport React from 'react';\nimport { Field as FieldRFF } from 'react-final-form';\nexport function DataDimensionField() {\n  return /*#__PURE__*/React.createElement(FieldRFF, {\n    component: CheckboxFieldFF,\n    dataTest: \"dataelementsformfields-datadimension\",\n    name: \"dataDimension\",\n    label: i18n.t('Data dimension'),\n    type: \"checkbox\",\n    validateFields: []\n  });\n}","import i18n from '@dhis2/d2-i18n';\nimport { ButtonStrip, Button, Field } from '@dhis2/ui';\nimport React, { useRef } from 'react';\nimport { useField } from 'react-final-form';\nimport { useHref } from 'react-router';\nimport { DataElementGroupsTransfer } from '../../../components';\nimport classes from './DataElementGroupsField.module.css';\n\n/**\n *\n * DataElementGroups\n *\n */\nexport function DataElementGroupsField() {\n  var _meta$error;\n  const name = 'dataElementGroups';\n  const {\n    input,\n    meta\n  } = useField(name, {\n    multiple: true,\n    format: dataElementGroups => dataElementGroups === null || dataElementGroups === void 0 ? void 0 : dataElementGroups.map(dataElementGroups => dataElementGroups.id),\n    parse: ids => ids.map(id => ({\n      id\n    })),\n    validateFields: []\n  });\n  const newDataElementGroupsLink = useHref('/dataElementGroups/new');\n  const dataElementGroupsHandle = useRef({\n    refetch: () => {\n      throw new Error('Not initialized');\n    }\n  });\n  const rightHeader = /*#__PURE__*/React.createElement(\"p\", {\n    className: classes.dataElementGroupsPickedHeader\n  }, i18n.t('Selected data element groups'));\n  const leftFooter = /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.dataElementGroupsOptionsFooter\n  }, /*#__PURE__*/React.createElement(ButtonStrip, null, /*#__PURE__*/React.createElement(Button, {\n    small: true,\n    onClick: dataElementGroupsHandle.current.refetch\n  }, i18n.t('Refresh list')), /*#__PURE__*/React.createElement(Button, {\n    small: true,\n    onClick: () => window.open(newDataElementGroupsLink, '_blank')\n  }, i18n.t('Add new'))));\n  return /*#__PURE__*/React.createElement(Field, {\n    dataTest: \"dataelementsformfields-dataElementGroupsets\",\n    error: !!meta.error,\n    validationText: (_meta$error = meta.error) === null || _meta$error === void 0 ? void 0 : _meta$error.toString(),\n    name: name\n  }, /*#__PURE__*/React.createElement(DataElementGroupsTransfer, {\n    ref: dataElementGroupsHandle,\n    selected: input.value,\n    onChange: _ref => {\n      let {\n        selected\n      } = _ref;\n      return input.onChange(selected);\n    },\n    rightHeader: rightHeader,\n    leftFooter: leftFooter\n  }));\n}","import i18n from '@dhis2/d2-i18n';\nimport React from 'react';\nimport { CustomAttributesSection, StandardFormSection, StandardFormSectionTitle, StandardFormSectionDescription, StandardFormField } from '../../../components';\nimport { DefaultIdentifiableFields, DescriptionField } from '../../../components/form';\nimport { SCHEMA_SECTIONS } from '../../../lib';\nimport { CompulsoryField, DataDimensionField, DataElementGroupsField } from '../fields';\nconst section = SCHEMA_SECTIONS.dataElementGroupSet;\nexport function DataElementGroupSetFormFields() {\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(StandardFormSection, null, /*#__PURE__*/React.createElement(StandardFormSectionTitle, null, i18n.t('Basic information')), /*#__PURE__*/React.createElement(StandardFormSectionDescription, null, i18n.t('Set up the information for this data element group')), /*#__PURE__*/React.createElement(DefaultIdentifiableFields, null), /*#__PURE__*/React.createElement(StandardFormField, null, /*#__PURE__*/React.createElement(DescriptionField, {\n    schemaSection: section,\n    helpText: i18n.t('Explain the purpose of this data element group.')\n  })), /*#__PURE__*/React.createElement(StandardFormField, null, /*#__PURE__*/React.createElement(CompulsoryField, null)), /*#__PURE__*/React.createElement(StandardFormField, null, /*#__PURE__*/React.createElement(DataDimensionField, null))), /*#__PURE__*/React.createElement(StandardFormSection, null, /*#__PURE__*/React.createElement(StandardFormSectionTitle, null, i18n.t('Data element groups')), /*#__PURE__*/React.createElement(StandardFormSectionDescription, null, ''), /*#__PURE__*/React.createElement(StandardFormField, null, /*#__PURE__*/React.createElement(DataElementGroupsField, null))), /*#__PURE__*/React.createElement(CustomAttributesSection, {\n    schemaSection: section\n  }));\n}","import { z } from 'zod';\nexport const dataElementGroupSetSchema = z.object({\n  name: z.string().trim(),\n  shortName: z.string().trim(),\n  code: z.string().trim(),\n  description: z.string().trim(),\n  dataElements: z.array(z.object({\n    id: z.string()\n  }))\n}).partial();","// extracted by mini-css-extract-plugin\nexport default {\"form\":\"New_form__VsLzA\"};","// extracted by mini-css-extract-plugin\nexport default {\"dataElementsOptionsFooter\":\"DataElementGroupsField_dataElementsOptionsFooter__l9fmA\",\"dataElementsPickedHeader\":\"DataElementGroupsField_dataElementsPickedHeader__uWdRL\"};"],"names":["listPath","getSectionPath","SCHEMA_SECTIONS","dataElementGroupSet","ADD_NEW_DATA_ELEMENT_GROUP_MUTATION","resource","type","data","de","Component","dataEngine","useDataEngine","navigate","useNavigate","customAttributesQuery","useCustomAttributesQuery","initialValues","customAttributes","name","shortName","code","description","compulsory","dataDimension","dataElementGroups","attributeValues","useMemo","map","attribute","value","React","Loader","queryResponse","label","i18n","t","Form","validateOnBlur","onSubmit","async","mutate","variables","payload","e","FORM_ERROR","toString","validate","values","dataElementGroupSetSchema","_ref","handleSubmit","submitting","submitError","FormContents","onCancelClick","_ref2","formErrorRef","useRef","useEffect","_formErrorRef$current","current","scrollIntoView","behavior","className","classes","form","DataElementGroupSetFormFields","StandardFormSection","ref","NoticeBox","error","title","StandardFormActions","cancelLabel","submitLabel","CompulsoryField","FieldRFF","component","CheckboxFieldFF","dataTest","validateFields","DataDimensionField","DataElementGroupsField","_meta$error","input","meta","useField","multiple","format","id","parse","ids","newDataElementGroupsLink","useHref","dataElementGroupsHandle","refetch","Error","rightHeader","dataElementGroupsPickedHeader","leftFooter","dataElementGroupsOptionsFooter","ButtonStrip","Button","small","onClick","window","open","Field","validationText","DataElementGroupsTransfer","selected","onChange","section","StandardFormSectionTitle","StandardFormSectionDescription","DefaultIdentifiableFields","StandardFormField","DescriptionField","schemaSection","helpText","CustomAttributesSection","z","object","string","trim","dataElements","array","partial"],"sourceRoot":""}