"use strict";(self.webpackChunk_dhis2_app_shell=self.webpackChunk_dhis2_app_shell||[]).push([[3994,1336,7091,9761,8677,9394,492],{71336:function(e,t,n){n.r(t),n.d(t,{OrganisationUnitList:function(){return C}});var l=n(9730),a=n(51112),r=n(72176),i=n(87899),o=n(68515),s=n(16231),c=n(7716),u=n(48138),d=n(41897),m=n(16680),g=n(30656),p=n(64125),f=n(77091),h=n(98677),E=n(27013),w=n(60492);const C=()=>{const e=(()=>{const{columns:e}=(0,s.kX)(),t=(0,m.pD)(m.fh.organisationUnit);return(0,r.useMemo)((()=>e.map((e=>({accessorKey:e.path,header:e.label,cell:n=>{let{row:l}=n;return r.createElement(c.J,{path:"name"===e.path?"displayName":e.path,schema:t,sectionModel:l.original})},meta:{fieldFilter:(0,g.Xq)(t,e.path)}})))),[e,t])})(),[t]=(0,m.dc)("identifiable"),n=(0,p.f)(),C=(0,r.useMemo)((()=>Object.fromEntries(n.map((e=>[e.id,!0])))),[n]),[b,y]=(0,r.useState)((()=>C)),[k,v]=(0,r.useState)((()=>C)),[S,U]=(0,r.useState)(),O=(0,r.useCallback)((e=>{let{id:t}=e;U((e=>e===t?void 0:t))}),[U]),A=e.map((e=>e.meta.fieldFilter)),{queries:R,fetchNextPage:D}=(0,w.usePaginatedChildrenOrgUnitsController)({parentIds:b,fieldFilters:A}),x=!!t,M=R.some((e=>e.isError)),F=(0,w.useFilteredOrgUnits)({searchQuery:t,fieldFilters:A,enabled:x});(0,r.useEffect)((()=>{if(!x)return v(C),void y(C);v(!0),y({})}),[x,C]);const{rootOrgUnits:N,flatOrgUnits:_}=(0,r.useMemo)((()=>{const e=new Map,t=R.concat(F).flatMap((e=>{var t;if(!e.data)return[];const n=null!==(t=e.data.organisationUnits)&&void 0!==t?t:[],l=n.flatMap((e=>e.ancestors));return[...n,...l]})).reduce(((t,n)=>(C[n.id]&&e.set(n.id,n),t[n.id]=n,t)),{});return{rootOrgUnits:Array.from(e.values()),flatOrgUnits:Object.values(t)}}),[R,F,C]),q=(0,r.useCallback)((e=>{const t=()=>Object.fromEntries(_.map((e=>[e.id,!0]))),n=e=>({...C,...e});"function"===typeof e?v((l=>{const a=e(l);return x||y(!0===a?t():n(a)),a})):(v(e),x||y(!0===e?t():n(e)))}),[x,v,_,C]),L=(0,l.N4)({columns:e,data:N,getRowId:e=>e.id,getCoreRowModel:(0,a.HT)(),getRowCanExpand:e=>e.original.childCount>0,getSubRows:e=>_.filter((t=>{var n;return(null===(n=t.parent)||void 0===n?void 0:n.id)===e.id})),getExpandedRowModel:(0,a.D0)(),onExpandedChange:q,state:{expanded:k},enableSubRowSelection:!1});return r.createElement("div",null,r.createElement(u.M,null),r.createElement(i.z2,null),r.createElement("div",{className:f.default.listDetailsWrapper},r.createElement(d.M,{selectedModels:new Set(L.getSelectedRowModel().flatRows.map((e=>e.id))),onDeselectAll:()=>{L.resetRowSelection(!0)}}),r.createElement(i._K,{headerColumns:L.getHeaderGroups()[0].headers.map((e=>({label:e.column.columnDef.header,path:e.column.id})))},r.createElement(h.OrganisationUnitListMessage,{isFiltering:x,queries:R.concat(F),orgUnitCount:L.getRowCount()}),L.getRowModel().rows.map((e=>r.createElement(E.OrganisationUnitRow,{key:e.id,row:e,toggleShowAll:e=>y((t=>{const{[e]:n,...l}=t;return n?l:{...t,[e]:!0}})),showAllActive:!0===b[e.original.id],onShowDetailsClick:O,isFiltering:x,hasErrored:M,fetchNextPage:D})))),S&&r.createElement(o.rn,{onClose:()=>U(void 0),key:S},r.createElement(o.VR,{modelId:S}))))}},99761:function(e,t,n){n.r(t),n.d(t,{OrganisationUnitListActions:function(){return b}});var l=n(28014),a=n(21039),r=n(95184),i=n(17982),o=n(85713),s=n(49266),c=n(15361),u=n(86284),d=n(72176),m=n(84586),g=n(14571),p=n(75204),f=n(50761),h=n(76680),E=n(41541),w=n(16680),C=n(99217);const b=e=>{let{model:t,onShowDetailsClick:n}=e;const l=(0,C.hv)(t),a=(0,m.useQueryClient)();return d.createElement(h.im,null,d.createElement(h.ZP,{modelId:t.id}),d.createElement(y,{deletable:l,model:t,onDeleteSuccess:()=>{a.invalidateQueries({queryKey:[{resource:"organisationUnits"}]})},onShowDetailsClick:n}))},y=e=>{let{deletable:t,model:n,onDeleteSuccess:m,onShowDetailsClick:h}=e;const[C,b]=(0,d.useState)(!1),y=(0,d.useRef)(null),k=(0,g.$P)(n.id,{relative:"path"}),v=(0,p.Gy)(n.id);return d.createElement("div",{ref:y},d.createElement(a.$,{small:!0,secondary:!0,onClick:()=>b(!C),dataTest:"row-actions-menu-button",icon:d.createElement(r.A,null)}),C&&d.createElement(i.A,{arrow:!1,placement:"bottom-end",reference:y,onClickOutside:()=>b(!1),dataTest:"row-actions-menu"},d.createElement(o.n,null,d.createElement(s.D,{dense:!0,label:l.A.t("Show details"),icon:d.createElement(c.A,null),onClick:()=>{h(n),b(!1)}}),d.createElement(s.D,{dense:!0,label:l.A.t("Edit"),icon:d.createElement(u.A,null),onClick:(e,t)=>{v(t),b(!1)},target:"_blank",href:k}),d.createElement(E.T,{condition:!t,content:w.H$.noDeleteAccess},d.createElement(f.S,{model:n,disabled:!t,onDeleteSuccess:()=>{m(),b(!1)},onCancel:()=>b(!1)})))))}},98677:function(e,t,n){n.r(t),n.d(t,{OrganisationUnitListMessage:function(){return s}});var l=n(28014),a=n(33587),r=n(72176),i=n(35573),o=n(66150);const s=e=>{let{orgUnitCount:t,isFiltering:n,queries:s}=e;const c=s.find((e=>e.error));if(c)return console.error(c.error),r.createElement(o.ut,null);return t<1&&s.some((e=>e.isLoading))?r.createElement(i.Z,null):n&&t<1?r.createElement(o.XL,null):t<1?r.createElement(o.Z5,null,r.createElement(a.o,null,l.A.t("No organisation units available"))):null}},27013:function(e,t,n){n.r(t),n.d(t,{OrganisationUnitRow:function(){return h}});var l=n(28014),a=n(12537),r=n(62251),i=n(21039),o=n(75012),s=n(31353),c=n(43399),u=n(81807),d=n(79432),m=n(9730),g=n(72176),p=n(77091),f=n(99761);const h=e=>{let{row:t,toggleShowAll:n,showAllActive:h,isFiltering:E,fetchNextPage:w,onShowDetailsClick:C,hasErrored:b}=e;const y=t.getParentRow();return g.createElement(g.Fragment,null,g.createElement(a.J,{key:t.id},g.createElement(r.B,null,g.createElement("span",{style:{paddingLeft:2*t.depth+"rem",display:"flex"}},t.getCanExpand()?g.createElement(g.Fragment,null,E&&(h||t.original.childCount!==t.subRows.length)&&g.createElement(i.$,{secondary:!0,onClick:()=>{n(t.original.id)},icon:h?g.createElement(o.A,null):g.createElement(s.A,null)},"Show all"),g.createElement(i.$,{className:p.default.expandButton,secondary:!0,type:"button",dataTest:"row-expand-icon",loading:t.getIsExpanded()&&t.subRows.length<1&&!b,icon:t.getIsExpanded()?g.createElement(c.A,null):g.createElement(u.A,null),onClick:t.getToggleExpandedHandler()})):null,g.createElement(d.S,{checked:t.getIsSelected(),onChange:e=>{let{checked:n}=e;return t.toggleSelected(n)}}))),t.getVisibleCells().map((e=>g.createElement(r.B,{key:e.id},(0,m.Kv)(e.column.columnDef.cell,e.getContext())))),g.createElement(r.B,null,g.createElement(f.OrganisationUnitListActions,{model:t.original,onShowDetailsClick:C}))),!E&&y&&y.getIsExpanded()&&y.subRows.length<(null===y||void 0===y?void 0:y.original.childCount)&&t===y.subRows[y.subRows.length-1]&&g.createElement(a.J,null,g.createElement(r.B,{colSpan:"100",style:{textAlign:"center"},onClick:()=>w(y.original.id)},l.A.t("Load more for {{orgUnitName}}",{orgUnitName:y.original.displayName}))))}},23994:function(e,t,n){n.r(t),n.d(t,{OrganisationUnitList:function(){return l.OrganisationUnitList}});var l=n(71336)},60492:function(e,t,n){n.r(t),n.d(t,{useFilteredOrgUnits:function(){return s},usePaginatedChildrenOrgUnitsController:function(){return c}});var l=n(72176),a=n(84586),r=n(27648);const i=["id","access","displayName","level","path","parent","children~size~rename(childCount)"],o=e=>{const t=i.concat(e),n=`ancestors[${t.join()},href]`;return t.concat(n)},s=e=>{let{fieldFilters:t,searchQuery:n,enabled:l}=e;const i=(0,r.sf)(),s={resource:"organisationUnits",params:{fields:o(t),query:n,withinUserHierarchy:!0}};return(0,a.useQuery)({enabled:l,queryKey:[s],queryFn:i,staleTime:6e4,cacheTime:6e4,keepPreviousData:!0})},c=e=>{const t=(0,r.sf)(),n=e.parentIds,[i,s]=(0,l.useState)(Object.fromEntries(Object.keys(n).map((e=>[e,[1]])))),c=(0,l.useMemo)((()=>Object.keys(n).flatMap((e=>(i[e]||[1]).map((t=>[e,t]))))),[n,i]),u=(0,l.useCallback)((e=>{s((t=>{const n=t[e]||[1];return{...t,[e]:[...n,n[n.length-1]+1]}}))}),[s]),d=c.map((n=>{let[l,a]=n;const r={resource:"organisationUnits",params:{fields:o(e.fieldFilters),filter:[`parent.id:eq:${l}`,`id:eq:${l}`],rootJunction:"OR",order:"displayName:asc",page:a}};return{enabled:e.enabled,queryKey:[r],queryFn:t,staleTime:6e4,cacheTime:6e4,meta:{parent:l}}}));return{queries:(0,a.useQueries)(d),fetchNextPage:u}}},77091:function(e,t,n){n.r(t),t.default={expandButton:"OrganisationUnitList_expandButton__AjbgN",listDetailsWrapper:"OrganisationUnitList_listDetailsWrapper__eX9Q3"}}}]);
//# sourceMappingURL=3994.46ad64a5.chunk.js.map